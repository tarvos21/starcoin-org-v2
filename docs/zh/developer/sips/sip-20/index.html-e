<!doctype html><html lang=zh><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" name=viewport><meta id=i18n_pagename content="index-common"><link rel=icon type=image/svg href=/img/stc.svg><link rel=stylesheet type=text/css href=/css/bootstrap.css><link rel=stylesheet href=/css/swiper-bundle.css><link rel=stylesheet type=text/css href=/css/nav.css><link rel=stylesheet type=text/css href=/css/nav_developer.css><link rel=stylesheet type=text/css href=/css/banner.css><link rel=stylesheet type=text/css href=/css/font_zh.css><link rel=stylesheet type=text/css href=/css/footer.css><link rel=stylesheet type=text/css href=/css/developer.css><link rel=stylesheet type=text/css href=/css/markdown.css><script src=/js/jquery.min.js></script><script src=/js/bootstrap.min.js></script><script src=/js/swiper-bundle.min.js></script><script>(function(c,d){const b=196;function a(){const a=document.documentElement.clientWidth/1920,c=b*Math.min(a,2);document.documentElement.style.fontSize=c+'px'}a(),addEventListener('resize',a,!1)})(document,window)</script><script>$(document).ready(function(){a(),$(window).resize(function(){a()});function a(){window.innerWidth<=768?($(".m-d-title").css("width",document.body.clientWidth-30+'px'),$(".m-d-content").css("width",document.body.clientWidth-30+'px'),$(".developer").css("marginLeft","-221px")):($(".m-d-title").css("width","auto"),$(".m-d-content").css("width","auto"),$(".developer").css("marginLeft","auto"))}$("#developer_open_move").click(function(){$(this).parent().attr("class").indexOf("active")>-1?($(this).find(".icon img").attr("src","/img/icon_block.png"),$(this).parent().removeClass("active")):($(this).find(".icon img").attr("src","/img/icon_block_active.png"),$(this).parent().addClass("active"))}),$(".m_left_nav_click").click(function(){$(this).attr("state")==0?($(this).attr("state",1),$(".m_mask").show(),$(".m-column-drawer").animate({marginLeft:"100px"})):($(this).attr("state",0),$(".m_mask").hide(),$(".m-column-drawer").animate({marginLeft:"-212px"}))}),$(".m_mask").click(function(){$(this).hide(),$(".m_left_nav_click").attr("state",0),$(".m-column-drawer").animate({marginLeft:"-212px"})})})</script><title>[SIP20] JSONRPC | Starcoin</title></head><body><div class=hidden-xs><div class=header_top></div><div class="top scrollTop-nav"><div class=container><a href=/zh><div class=logo><img src=/img/logo.png></div></a><div class="nav navClick"><div class="item Overview allSelect"><span class=i18n href=/zh/>首页</span><div class=more_nav><div class=box><div class=li><a class=i18n href=/zh/overview/technology_whitepaper/>技术白皮书</a></div><div class=li><a class=i18n href=/zh/overview/economy_whitepaper/>经济模型白皮书</a></div></div></div></div><div class="item Guide allSelect"><span class=i18n>使用指南</span><div class=more_nav><div class=box><div class=li><a class=i18n href=/zh/developer/tutorials/starcoin_wallet/>Starcoin钱包</a></div><div class=li><a class=i18n onclick="return window.open('https://github.com/starcoinorg/starmask-extension/blob/main/docs/how-to-use.md',''),!1" href=javascript:void(0)>StarMask浏览器钱包</a></div><div class=li><a class=i18n href=/zh/developer/cli/mint/>节点挖矿</a></div><div class=li><a class=i18n href=/zh/developer/cli/>节点命令</a></div></div></div></div><div class="item Developer allSelect"><span class=i18n>开发者</span><div class=more_nav><div class=box><div class=li><span class=i18n>Node</span><div class=second_nav><div class=li><a class=i18n href=/zh/developer/key_concepts/concept>关键概念</a></div><div class=li><a class=i18n href=/zh/developer/rpc/rpc_document/>RPC 协议</a></div><div class=li><a class=i18n href=/zh/developer/sips/>SIPs</a></div><div class=li><a class=i18n href=/zh/developer/sdk/>SDK</a></div></div></div><div class=li><span class=i18n>Move</span><div class=second_nav><div class=li><a class=i18n onclick="return window.open('https://move-book.com/cn/index.html',''),!1" href=javascript:void(0)>Move 开发指南</a></div><div class=li><a class=i18n onclick="return window.open(' https://github.com/starcoinorg/starcoin/blob/master/vm/move-cli/README.md',''),!1" href=javascript:void(0)>Move IDE</a></div><div class=li><a class=i18n onclick="return window.open('https://github.com/starcoinorg/starcoin/blob/master/vm/move-cli/README.zh.md',''),!1" href=javascript:void(0)>Move CLI</a></div><div class=li><a class=i18n href=/zh/developer/move/example>Move 合约示例</a></div></div></div><div class=li><span class=i18n>矿池接入</span><div class=second_nav><div class=li><a class=i18n onclick="return window.open('https://github.com/starcoinorg/starcoin/discussions/2541',''),!1" href=javascript:void(0)>矿池接入</a></div><div class=li><a class=i18n onclick="return window.open('https://github.com/starcoinorg/starcoin/blob/b47429fc792fe9fabd1587fa60a9cae249f0b67f/stratum/stratum_mining_protocol.md',''),!1" href=javascript:void(0)>矿池协议</a></div></div></div><div class=li><a class=i18n href=/zh/developer/>更多</a></div></div></div></div><div class="item Community allSelect"><span class=i18n>社区</span><div class=more_nav><div class=box><div class=li><a class=i18n href=/zh/news/>新闻</a></div><div class=li><a class=i18n onclick="return window.open('http://westar.io',''),!1" href=javascript:void(0)>Westar 实验室</a></div><div class=li><a class=i18n onclick="return window.open('https://www.movelang.io',''),!1" href=javascript:void(0)>Move 中文社区</a></div><div class=li><a class=i18n onclick="return window.open('https://explorer.starcoin.org',''),!1" href=javascript:void(0)>Starcoin 浏览器</a></div><div class=li><a class=i18n onclick="return window.open('https://poll.starcoin.org',''),!1" href=javascript:void(0)>Starcoin 投票</a></div></div></div></div><div class="item About allSelect"><a class=i18n href=/zh/about><span class=i18n>关于</span></a></div></div><div class="language p-language"><span language=en>English</span>｜<span language=zh>中文</span></div></div></div></div><div class=visible-xs style=display:block><div class="header_top m_header_top"></div><div class="top m_top scrollTop-nav"><div class="container m_container"><a href=/><div class=m_logo><img src=/img/logo.png></div></a><div class="m_nav m_nav_tap"><img src=/img/m_nav_more.png></div></div></div><div class=m_nav_model><div class="nav navClick m_nav_navigation"><div class="item Overview allSelect"><span class=i18n href=/zh/>首页</span><div class=more_nav><div class=box><div class=li><a class=i18n href=/zh/overview/technology_whitepaper/>技术白皮书</a></div><div class=li><a class=i18n href=/zh/overview/economy_whitepaper/>经济模型白皮书</a></div></div></div></div><div class="item Guide allSelect"><span class=i18n>使用指南</span><div class=more_nav><div class=box><div class=li><a class=i18n href=/zh/developer/tutorials/starcoin_wallet/>Starcoin钱包</a></div><div class=li><a class=i18n onclick="return window.open('https://github.com/starcoinorg/starmask-extension/blob/main/docs/how-to-use.md',''),!1" href=javascript:void(0)>StarMask浏览器钱包</a></div><div class=li><a class=i18n href=/zh/developer/cli/mint/>节点挖矿</a></div><div class=li><a class=i18n href=/zh/developer/cli/>节点命令</a></div></div></div></div><div class="item Developer allSelect"><span class=i18n>开发者</span><div class=more_nav><div class=box><div class=li><span class=i18n>Node</span><div class=second_nav><div class=li><a class=i18n href=/zh/developer/key_concepts/concept>关键概念</a></div><div class=li><a class=i18n href=/zh/developer/rpc/rpc_document/>RPC 协议</a></div><div class=li><a class=i18n href=/zh/developer/sips/>SIPs</a></div><div class=li><a class=i18n href=/zh/developer/sdk/>SDK</a></div></div></div><div class=li><span class=i18n>Move</span><div class=second_nav><div class=li><a class=i18n onclick="return window.open('https://move-book.com/cn/index.html',''),!1" href=javascript:void(0)>Move 开发指南</a></div><div class=li><a class=i18n onclick="return window.open(' https://github.com/starcoinorg/starcoin/blob/master/vm/move-cli/README.md',''),!1" href=javascript:void(0)>Move IDE</a></div><div class=li><a class=i18n onclick="return window.open('https://github.com/starcoinorg/starcoin/blob/master/vm/move-cli/README.zh.md',''),!1" href=javascript:void(0)>Move CLI</a></div><div class=li><a class=i18n href=/zh/developer/move/example>Move 合约示例</a></div></div></div><div class=li><span class=i18n>矿池接入</span><div class=second_nav><div class=li><a class=i18n onclick="return window.open('https://github.com/starcoinorg/starcoin/discussions/2541',''),!1" href=javascript:void(0)>矿池接入</a></div><div class=li><a class=i18n onclick="return window.open('https://github.com/starcoinorg/starcoin/blob/b47429fc792fe9fabd1587fa60a9cae249f0b67f/stratum/stratum_mining_protocol.md',''),!1" href=javascript:void(0)>矿池协议</a></div></div></div><div class=li><a class=i18n href=/zh/developer/>更多</a></div></div></div></div><div class="item Community allSelect"><span class=i18n>社区</span><div class=more_nav><div class=box><div class=li><a class=i18n href=/zh/news/>新闻</a></div><div class=li><a class=i18n onclick="return window.open('http://westar.io',''),!1" href=javascript:void(0)>Westar 实验室</a></div><div class=li><a class=i18n onclick="return window.open('https://www.movelang.io',''),!1" href=javascript:void(0)>Move 中文社区</a></div><div class=li><a class=i18n onclick="return window.open('https://explorer.starcoin.org',''),!1" href=javascript:void(0)>Starcoin 浏览器</a></div><div class=li><a class=i18n onclick="return window.open('https://poll.starcoin.org',''),!1" href=javascript:void(0)>Starcoin 投票</a></div></div></div></div><div class="item About allSelect"><a class=i18n href=/zh/about><span class=i18n>关于</span></a></div></div><div class=m-language><div language=zh class=item>中文<div class=line></div></div><div language=en class=item>English</div></div></div><div class=clearfix></div></div><script>$(document).ready(function(){const a=JSON.parse(localStorage.getItem('navActive'))||0;$(".navClick .item")[a].classList.add('navActive'),$(".p-language span, .m-language .item").click(function(){let a=window.location.href,b=$(this).attr('language'),c="zh";c!==b&&(a=a.replace(`/${c}/`,`/${b}/`),window.location.href=a)}),$(".navClick .item").click(function(){let b=$(this)[0]||null;if(b){b.classList.add('navActive');let e=[],d=b.parentNode.children;for(var a=0,c=d.length;a<c;a++)d[a]!==b?e.push(d[a]):localStorage.setItem('navActive',a);e.forEach(a=>{a.classList.remove('navActive')})}$(this).attr("href")&&window.open($(this).attr("href"),"_self")}),$(".more_nav .box .li").click(function(){$(this).attr("href")&&window.open($(this).attr("href"),"_self")}),$(".m_nav_navigation").find(".allSelect").click(function(){$(this).attr("class").indexOf("m_tab_select")>-1?(console.log($(this)),$(this).removeClass("m_tab_select")):$(this).addClass("m_tab_select")}),$(".m_nav_tap").click(function(){$(this).find("img").attr("src")=="/img/m_nav_more.png"?($(this).find("img").attr("src","/img/m_nav_close.png"),$(".m_nav_model").show(),$(".m_nav_model").animate({height:"100%"}),$(".scrollTop-nav").addClass("home-nav")):($(this).find("img").attr("src","/img/m_nav_more.png"),$(".scrollTop-nav").removeClass("home-nav"),$(".m_nav_model").animate({height:"0%"}),$(".m_nav_model").hide())})})</script><link rel=stylesheet href=/css/news.css><div class=container><div class=news><div class=news_list><div class="tile is-child box"><div class=content><div class=content-title><h1 class="title is-size-1">[SIP20] JSONRPC</h1></div>Published at January 1, 0001 By @lerencao.<hr style="margin:5px 0 10px"><h1 id=统一-jsonrpc-接口的参数和返回值类型>统一 JSONRPC 接口的参数和返回值类型</h1><p>目前 Starcoin 的 json rpc 接口返回值类型直接使用了内部的数据结构，比如 Block, Header, Transaction, TransactionInfo 等等。
但是在接口的实际使用过程中，这些内部结构的字段无法满足外部使用需求，往往是缺乏必要的关联字段，比如外部使用可能需要 TransactionInfo 里包含 txn 被打包的 block id，亦或是某个 u64 类型的字段序列化成 json 后，无法被 javascript 端的正确的解析出来。
为了解决诸如此类的问题，该 RFC 定义了一系列 jsonrpc 接口返回值类型，试图将内部使用的数据结构和对外接口的数据结构解耦。</p><h2 id=类型定义>类型定义</h2><p>经过梳理，接口中使用的以下几类核心数据结构需要替换成自定义的对外返回的类型。</p><ul><li>Block, 以及关联的 BlockHeader, BlockBody。</li><li>Transaction，以及关联的 RawUserTransaction，BlockMetadata 等。</li><li>TransactionInfo：Transaction 在链上的结果数据。</li><li>Transaction 在链上产生的 Events 数据。</li></ul><p>以下部分列出了新的接口返回类型定义。</p><h3 id=block>Block</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>BlockView</span> {
    <span style=color:#66d9ef>pub</span> header: <span style=color:#a6e22e>BlockHeaderView</span>,
    <span style=color:#66d9ef>pub</span> body: <span style=color:#a6e22e>BlockTransactionsView</span>,
    <span style=color:#66d9ef>pub</span> uncles: Vec<span style=color:#f92672>&lt;</span>BlockHeaderView<span style=color:#f92672>&gt;</span>,
}

<span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>BlockHeaderView</span> {
    <span style=color:#e6db74>/// block hash
</span><span style=color:#e6db74></span>    <span style=color:#66d9ef>pub</span> block_hash: <span style=color:#a6e22e>HashValue</span>,
    <span style=color:#e6db74>/// Parent hash.
</span><span style=color:#e6db74></span>    <span style=color:#66d9ef>pub</span> parent_hash: <span style=color:#a6e22e>HashValue</span>,
    <span style=color:#e6db74>/// Block timestamp.
</span><span style=color:#e6db74></span>    <span style=color:#66d9ef>pub</span> timestamp: <span style=color:#66d9ef>u64</span>,
    <span style=color:#e6db74>/// Block number.
</span><span style=color:#e6db74></span>    <span style=color:#66d9ef>pub</span> number: <span style=color:#a6e22e>BlockNumber</span>,
    <span style=color:#e6db74>/// Block author.
</span><span style=color:#e6db74></span>    <span style=color:#66d9ef>pub</span> author: <span style=color:#a6e22e>AccountAddress</span>,
    <span style=color:#e6db74>/// Block author auth key.
</span><span style=color:#e6db74></span>    <span style=color:#66d9ef>pub</span> author_auth_key: Option<span style=color:#f92672>&lt;</span>AuthenticationKey<span style=color:#f92672>&gt;</span>,
    <span style=color:#e6db74>/// The transaction accumulator root hash after executing this block.
</span><span style=color:#e6db74></span>    <span style=color:#66d9ef>pub</span> accumulator_root: <span style=color:#a6e22e>HashValue</span>,
    <span style=color:#e6db74>/// The parent block accumulator root hash.
</span><span style=color:#e6db74></span>    <span style=color:#66d9ef>pub</span> parent_block_accumulator_root: <span style=color:#a6e22e>HashValue</span>,
    <span style=color:#e6db74>/// The last transaction state_root of this block after execute.
</span><span style=color:#e6db74></span>    <span style=color:#66d9ef>pub</span> state_root: <span style=color:#a6e22e>HashValue</span>,
    <span style=color:#e6db74>/// Gas used for contracts execution.
</span><span style=color:#e6db74></span>    <span style=color:#66d9ef>pub</span> gas_used: <span style=color:#66d9ef>u64</span>,
    <span style=color:#e6db74>/// Block difficulty
</span><span style=color:#e6db74></span>    <span style=color:#66d9ef>pub</span> difficulty: <span style=color:#a6e22e>U256</span>,
    <span style=color:#e6db74>/// Consensus nonce field.
</span><span style=color:#e6db74></span>    <span style=color:#66d9ef>pub</span> nonce: <span style=color:#66d9ef>u32</span>,
    <span style=color:#e6db74>/// hash for block body
</span><span style=color:#e6db74></span>    <span style=color:#66d9ef>pub</span> body_hash: <span style=color:#a6e22e>HashValue</span>,
    <span style=color:#e6db74>/// The chain id
</span><span style=color:#e6db74></span>    <span style=color:#66d9ef>pub</span> chain_id: <span style=color:#66d9ef>u8</span>,
}
<span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>enum</span> <span style=color:#a6e22e>BlockTransactionsView</span> {
    Hashes(Vec<span style=color:#f92672>&lt;</span>HashValue<span style=color:#f92672>&gt;</span>),
    Full(Vec<span style=color:#f92672>&lt;</span>SignedUserTransactionView<span style=color:#f92672>&gt;</span>),
}
</code></pre></div><p>需要注意的是，BlockBodyView 包含了两种，一种是只包含 block 中所有 transaction 的 hash 值，另外一种是完整的 txn 数据。这样客户端在不需要具体 txn 数据时，可以选择性调用。</p><h3 id=transaction>Transaction</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>TransactionView</span> {
    block_hash: <span style=color:#a6e22e>HashValue</span>,
    block_number: <span style=color:#a6e22e>BlockNumber</span>,
    transaction_hash: <span style=color:#a6e22e>HashValue</span>,
    transaction_index: <span style=color:#66d9ef>u64</span>,
    block_metadata: Option<span style=color:#f92672>&lt;</span>BlockMetadataView<span style=color:#f92672>&gt;</span>,
    user_transaction: Option<span style=color:#f92672>&lt;</span>SignedUserTransactionView<span style=color:#f92672>&gt;</span>,
}
<span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>BlockMetadataView</span> {
    <span style=color:#e6db74>/// Parent block hash.
</span><span style=color:#e6db74></span>    <span style=color:#66d9ef>pub</span> parent_hash: <span style=color:#a6e22e>HashValue</span>,
    <span style=color:#66d9ef>pub</span> timestamp: <span style=color:#66d9ef>u64</span>,
    <span style=color:#66d9ef>pub</span> author: <span style=color:#a6e22e>AccountAddress</span>,
    <span style=color:#66d9ef>pub</span> author_auth_key: Option<span style=color:#f92672>&lt;</span>AuthenticationKey<span style=color:#f92672>&gt;</span>,
    <span style=color:#66d9ef>pub</span> uncles: <span style=color:#66d9ef>u64</span>,
    <span style=color:#66d9ef>pub</span> number: <span style=color:#a6e22e>BlockNumber</span>,
    <span style=color:#66d9ef>pub</span> chain_id: <span style=color:#66d9ef>u8</span>,
    <span style=color:#66d9ef>pub</span> parent_gas_used: <span style=color:#66d9ef>u64</span>,
}
<span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>SignedUserTransactionView</span> {
    <span style=color:#e6db74>/// The raw transaction
</span><span style=color:#e6db74></span>    <span style=color:#66d9ef>pub</span> raw_txn: <span style=color:#a6e22e>RawUserTransactionView</span>,

    <span style=color:#e6db74>/// Public key and signature to authenticate
</span><span style=color:#e6db74></span>    <span style=color:#66d9ef>pub</span> authenticator: <span style=color:#a6e22e>TransactionAuthenticator</span>,
}
<span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>RawUserTransactionView</span> {
    <span style=color:#e6db74>/// Sender&#39;s address.
</span><span style=color:#e6db74></span>    <span style=color:#66d9ef>pub</span> sender: <span style=color:#a6e22e>AccountAddress</span>,
    <span style=color:#75715e>// Sequence number of this transaction corresponding to sender&#39;s account.
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>pub</span> sequence_number: <span style=color:#66d9ef>u64</span>,

    <span style=color:#75715e>// The transaction payload in scs bytes.
</span><span style=color:#75715e></span>    <span style=color:#75715e>#[serde(serialize_with = </span><span style=color:#e6db74>&#34;serialize_binary&#34;</span><span style=color:#75715e>)]</span>
    <span style=color:#66d9ef>pub</span> payload: Vec<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>u8</span><span style=color:#f92672>&gt;</span>,

    <span style=color:#75715e>// Maximal total gas specified by wallet to spend for this transaction.
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>pub</span> max_gas_amount: <span style=color:#66d9ef>u64</span>,
    <span style=color:#75715e>// Maximal price can be paid per gas.
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>pub</span> gas_unit_price: <span style=color:#66d9ef>u64</span>,
    <span style=color:#75715e>// The token code for pay transaction gas, Default is STC token code.
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>pub</span> gas_token_code: String,
    <span style=color:#75715e>// Expiration timestamp for this transaction. timestamp is represented
</span><span style=color:#75715e></span>    <span style=color:#75715e>// as u64 in seconds from Unix Epoch. If storage is queried and
</span><span style=color:#75715e></span>    <span style=color:#75715e>// the time returned is greater than or equal to this time and this
</span><span style=color:#75715e></span>    <span style=color:#75715e>// transaction has not been included, you can be certain that it will
</span><span style=color:#75715e></span>    <span style=color:#75715e>// never be included.
</span><span style=color:#75715e></span>    <span style=color:#75715e>// A transaction that doesn&#39;t expire is represented by a very large value like
</span><span style=color:#75715e></span>    <span style=color:#75715e>// u64::max_value().
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>pub</span> expiration_timestamp_secs: <span style=color:#66d9ef>u64</span>,
    <span style=color:#66d9ef>pub</span> chain_id: <span style=color:#66d9ef>u8</span>,
}
</code></pre></div><p>这里需要注意两点：</p><ol><li>TransactionView 将 BlockMedata 类型和 SignedUserTransaction 平铺在一起，减少嵌套，绝大部分情况下，外部调用应该只关心 <code>user_transaction</code> 字段。</li><li>RawUserTransactionView 中，将 payload 存储为 scs 序列化后的 bytes 数据，外部如果需要使用里面的具体数据，可以通过 scs 反序列化成 scs 数据结构。这样可以减少 payload 复杂的数据结构给 jsonrpc 使用端带来的负担。</li></ol><h3 id=transactioninfo>TransactionInfo</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>TransactionInfoView</span> {
    block_hash: <span style=color:#a6e22e>HashValue</span>,
    block_number: <span style=color:#a6e22e>BlockNumber</span>,
    <span style=color:#e6db74>/// The hash of this transaction.
</span><span style=color:#e6db74></span>    transaction_hash: <span style=color:#a6e22e>HashValue</span>,
    transaction_index: <span style=color:#66d9ef>u64</span>,
    <span style=color:#e6db74>/// The root hash of Sparse Merkle Tree describing the world state at the end of this
</span><span style=color:#e6db74></span>    <span style=color:#e6db74>/// transaction.
</span><span style=color:#e6db74></span>    state_root_hash: <span style=color:#a6e22e>HashValue</span>,

    <span style=color:#e6db74>/// The root hash of Merkle Accumulator storing all events emitted during this transaction.
</span><span style=color:#e6db74></span>    event_root_hash: <span style=color:#a6e22e>HashValue</span>,

    <span style=color:#e6db74>/// The amount of gas used.
</span><span style=color:#e6db74></span>    gas_used: <span style=color:#66d9ef>u64</span>,

    <span style=color:#e6db74>/// The vm status. If it is not `Executed`, this will provide the general error class. Execution
</span><span style=color:#e6db74></span>    <span style=color:#e6db74>/// failures and Move abort&#39;s receive more detailed information. But other errors are generally
</span><span style=color:#e6db74></span>    <span style=color:#e6db74>/// categorized with no status code or other information
</span><span style=color:#e6db74></span>    status: <span style=color:#a6e22e>TransactionVMStatus</span>,
}

<span style=color:#75715e>#[derive(Clone, Debug, Hash, Eq, PartialEq, Serialize)]</span>
<span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>enum</span> <span style=color:#a6e22e>TransactionVMStatus</span> {
    Executed,
    OutOfGas,
    MoveAbort {
        location: <span style=color:#a6e22e>AbortLocation</span>,
        abort_code: <span style=color:#66d9ef>u64</span>,
    },
    ExecutionFailure {
        location: <span style=color:#a6e22e>AbortLocation</span>,
        function: <span style=color:#66d9ef>u16</span>,
        code_offset: <span style=color:#66d9ef>u16</span>,
    },
    MiscellaneousError,
}
</code></pre></div><p>TransactionInfoView 中在 TransactionInfo 的基础上加入了 txn 所在 block 的相关信息。</p><h3 id=transaction-events>Transaction Events</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>TransactionEventView</span> {
    <span style=color:#66d9ef>pub</span> block_hash: Option<span style=color:#f92672>&lt;</span>HashValue<span style=color:#f92672>&gt;</span>,
    <span style=color:#66d9ef>pub</span> block_number: Option<span style=color:#f92672>&lt;</span>BlockNumber<span style=color:#f92672>&gt;</span>,
    <span style=color:#66d9ef>pub</span> transaction_hash: Option<span style=color:#f92672>&lt;</span>HashValue<span style=color:#f92672>&gt;</span>,
    <span style=color:#75715e>// txn index in block
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>pub</span> transaction_index: Option<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>u64</span><span style=color:#f92672>&gt;</span>,

    <span style=color:#66d9ef>pub</span> data: Vec<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>u8</span><span style=color:#f92672>&gt;</span>,
    <span style=color:#66d9ef>pub</span> type_tags: <span style=color:#a6e22e>TypeTag</span>,
    <span style=color:#66d9ef>pub</span> event_key: <span style=color:#a6e22e>EventKey</span>,
    <span style=color:#66d9ef>pub</span> event_seq_number: <span style=color:#66d9ef>u64</span>,
}
</code></pre></div><h2 id=缺点>缺点</h2><p>自定义的 rpc 类型定义大部分和已有的内部结构，在数据字段上是重叠的，显的繁琐和重复。</p></div></div></div><div class=news_right><div class=right_card><div class=right-column><div class=column_title><span>Tags</span></div></div><div class=column_list><div class=item><a href=/zh/tags/competition>competition</a></div><div class=item><a href=/zh/tags/epoch>epoch</a></div><div class=item><a href=/zh/tags/halley>halley</a></div><div class=item><a href=/zh/tags/mining>mining</a></div><div class=item><a href=/zh/tags/move>move</a></div><div class=item><a href=/zh/tags/movelang>movelang</a></div><div class=item><a href=/zh/tags/release>release</a></div><div class=item><a href=/zh/tags/security>security</a></div><div class=item><a href=/zh/tags/starcoin>starcoin</a></div><div class=item><a href=/zh/tags/testnet>testnet</a></div></div></div><div class=right_card><div class="right-column margin-top"><div class=column_title><span>Recent posts</span></div></div><div class=posts_list><ul><li><a href=https://starcoin-org.git.xin/zh/news/post/starcoin_stdlib_upgrade_v5_finished/>Starcoin Move 合约标准库 v5 版升级完成</a><p><time class="has-text-grey-light is-size-7">17 June 2021</time></p></li><li><a href=https://starcoin-org.git.xin/zh/news/post/starcoin_stdlib_upgrade_v5_poll_pass/>Starcoin Move 合约标准库 v5 版升级投票通过，将于 24 小时后后执行</a><p><time class="has-text-grey-light is-size-7">15 June 2021</time></p></li><li><a href=https://starcoin-org.git.xin/zh/news/post/starcoin_stdlib_upgrade_v5/>Starcoin Move 合约标准库 v5 版升级投票开始</a><p><time class="has-text-grey-light is-size-7">8 June 2021</time></p></li><li><a href=https://starcoin-org.git.xin/zh/news/post/release_starcoin_v1.0.0/>Starcoin 发布 v1.0.0 版，主网正式启动</a><p><time class="has-text-grey-light is-size-7">18 May 2021</time></p></li><li><a href=https://starcoin-org.git.xin/zh/news/post/release_starcoin_v1.0.0-rc/>Starcoin 发布 v1.0.0-rc 版，主网将在 Barnard 网络的 310000 高度启动</a><p><time class="has-text-grey-light is-size-7">17 May 2021</time></p></li></ul></div></div><div class=right_card><div class="right-column margin-top"><div class=column_title><span>Archives</span></div></div><div class=date_list><div class=item><a href=/zh/archives/2021>2021</a>（9）</div><div class=item><a href=/zh/archives/2020>2020</a>（11）</div></div></div></div></div></div><div class="footer visible-lg"><div class=container><div class="row hr"><div class="col-md-4 item">联系我们</div><div class="col-md-4 item">技术</div><div class="col-md-4 item">社区</div></div><div class="row td"><div class="col-md-4 item">微信公众号: Starcoin区块链</div><div class="col-md-4 item"><a target=_blank href="https://chrome.google.com/webstore/detail/starmask/mfhbebgoclkghebffdldpobeajmbecfk?hl=zh-CN">StarMask 插件钱包</a></div><div class="col-md-4 item"><a target=_blank href=https://starcoin.org/zh/news/>新闻</a></div></div><div class="row td"><div class="col-md-4 item">推特: <a target=_blank href=https://twitter.com/starcoinstc>StarcoinSTC</a></div><div class="col-md-4 item"><a target=_blank href=https://explorer.starcoin.org>区块浏览器</a></div><div class="col-md-4 item"><a target=_blank href=https://westar.io>Westar 实验室</a></div></div><div class="row td"><div class="col-md-4 item">微信群请加: starcoinorg</div><div class="col-md-4 item"><a target=_blank href=https://starcoin.org/zh/developer/>开发者文档</a></div><div class="col-md-4 item"><a target=_blank href=https://www.movelang.io>Move 中文社区</a></div></div><div class="row td"><div class="col-md-4 item">Discord 群: <a target=_blank href=https://discord.gg/96tKt5exaE>Starcoin Spaceship</a></div><div class="col-md-4 item"><a target=_blank href=https://starcoin.org/zh/developer/sdk/>SDK</a></div><div class="col-md-4 item"><a target=_blank href=https://github.com/starcoinorg/starcoin/discussions>GitHub 讨论区</a></div></div><div class=foot><div class=copyright>© 2018-2021 Starcoin.org 保留一切权利。</div></div></div></div><div class="m-footer visible-xs visible-sm visible-md"><div class=container><div class=go-contact-us>联系我们<img src=/img/r-arrow.png></div><div class=row-li><div class=item>微信公众号: Starcoin区块链</div><div class=item>微信群请加: starcoinorg</div></div><div class=row-li><div class=item>推特: <a target=_blank href=https://twitter.com/starcoinstc>StarcoinSTC</a></div><div class=item>Discord 群: <a target=_blank href=https://discord.gg/96tKt5exaE>Starcoin Spaceship</a></div></div><div class=go-contact-us>技术<img src=/img/r-arrow.png></div><div class=row-li><div class=item><a target=_blank href="https://chrome.google.com/webstore/detail/starmask/mfhbebgoclkghebffdldpobeajmbecfk?hl=zh-CN">StarMask 插件钱包</a></div><div class=item><a target=_blank href=https://explorer.starcoin.org>区块浏览器</a></div></div><div class=row-li><div class=item><a target=_blank href=https://starcoin.org/zh/developer/>开发者文档</a></div><div class=item><a target=_blank href=https://starcoin.org/zh/developer/sdk/>SDK</a></div></div><div class=go-contact-us>社区<img src=/img/r-arrow.png></div><div class=row-li><div class=item><a target=_blank href=https://starcoin.org/zh/news/>新闻</a></div><div class=item><a target=_blank href=https://westar.io>Westar 实验室</a></div></div><div class=row-li><div class=item><a target=_blank href=https://www.movelang.io>Move 中文社区</a></div><div class=item><a target=_blank href=https://github.com/starcoinorg/starcoin/discussions>GitHub 讨论区</a></div></div><div class=crt>© 2018-2021 Starcoin.org 保留一切权利。</div></div></div></body></html>