<!doctype html><html lang=en><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" name=viewport><meta id=i18n_pagename content="index-common"><link rel=icon type=image/svg href=/img/stc.svg><link rel=stylesheet type=text/css href=/css/bootstrap.css><link rel=stylesheet href=/css/swiper-bundle.css><link rel=stylesheet type=text/css href=/css/nav.css><link rel=stylesheet type=text/css href=/css/nav_developer.css><link rel=stylesheet type=text/css href=/css/banner.css><link rel=stylesheet type=text/css href=/css/font_en.css><link rel=stylesheet type=text/css href=/css/footer.css><link rel=stylesheet type=text/css href=/css/developer.css><link rel=stylesheet type=text/css href=/css/markdown.css><script src=/js/jquery.min.js></script><script src=/js/bootstrap.min.js></script><script src=/js/swiper-bundle.min.js></script><script>(function(c,d){const b=196;function a(){const a=document.documentElement.clientWidth/1920,c=b*Math.min(a,2);document.documentElement.style.fontSize=c+'px'}a(),addEventListener('resize',a,!1)})(document,window)</script><script>$(document).ready(function(){a(),$(window).resize(function(){a()}),$(function(){$('.footer [data-toggle="tooltip"]').tooltip({})});function a(){}$("#developer_open_move").click(function(){$(this).parent().attr("class").indexOf("active")>-1?($(this).find(".icon img").attr("src","/img/icon_block.png"),$(this).parent().removeClass("active")):($(this).find(".icon img").attr("src","/img/icon_block_active.png"),$(this).parent().addClass("active"))})})</script><title>Sync protocols | Starcoin</title></head><body><div class=hidden-xs><div class=header_top></div><div class="top scrollTop-nav"><div class=top-container><a href=/en><img class=logo src=/img/logo.png></a><div class=top-right><div class="nav navClick"><div class="item Overview allSelect"><span class=i18n href=/en/>Overview</span><div class=more_nav><div class=box><div class=li><a class=i18n href=/downloads/Starcoin_en.pdf target=_blank>Starcoin
& Move</a></div><div class=li><a class=i18n href=/en/overview/technology_whitepaper/>Technology Whitepaper</a></div><div class=li><a class=i18n href=/en/overview/economy_whitepaper/>Economy Whitepaper</a></div></div></div></div><div class="item Guide allSelect"><span class=i18n>Learn</span><div class=more_nav><div class=box><div class=li><a class=i18n href=https://github.com/starcoinorg/starmask-extension/blob/main/docs/how-to-use.md target=_blank>StarMask Chrome Wallet</a></div><div class=li><a class=i18n href=/en/developer/cli/mint/>Node Mining</a></div><div class=li><a class=i18n href=/en/developer/cli/>Node Command</a></div></div></div></div><div class="item Developer allSelect"><span class=i18n>Developer</span><div class=more_nav><div class=box><div class=li><span class=i18n>Get Started</span><div class=second_nav><div class=li><a class=i18n href=/en/developer/setup/install target=_blank>Install</a></div><div class=li><a class=i18n href=/en/developer/setup/build target=_blank>Build from Source</a></div><div class=li><a class=i18n href=/en/developer/setup/run_by_docker target=_blank>Run by Docker</a></div><div class=li><a class=i18n href=/en/developer/setup/runnetwork target=_blank>Run/Join Network</a></div></div></div><div class=li><span class=i18n>Node</span><div class=second_nav><div class=li><a class=i18n href=/en/developer/key_concepts/concept>Key Concept</a></div><div class=li><a class=i18n href=/en/developer/rpc/rpc_document/>RPC Protocol & APIs</a></div><div class=li><a class=i18n href=/en/developer/sips/>SIPs</a></div><div class=li><a class=i18n href=/en/developer/sdk/>SDK</a></div></div></div><div class=li><span class=i18n>Move</span><div class=second_nav><div class=li><a class=i18n href=https://move-book.com/cn/index.html target=_blank>Move Book</a></div><div class=li><a class=i18n href=https://github.com/starcoinorg/starcoin/blob/master/vm/move-cli/README.md target=_blank>Move IDE</a></div><div class=li><a class=i18n href=https://github.com/starcoinorg/starcoin/blob/master/vm/move-cli/README.zh.md target=_blank>Move CLI</a></div><div class=li><a class=i18n href=/en/developer/move/example>Move Examples</a></div></div></div><div class=li><span class=i18n>Stratum Pool Guide</span><div class=second_nav><div class=li><a class=i18n href=https://github.com/starcoinorg/starcoin/discussions/2541 target=_blank>Stratum Pool Guide</a></div><div class=li><a class=i18n href=https://github.com/starcoinorg/starcoin/blob/b47429fc792fe9fabd1587fa60a9cae249f0b67f/stratum/stratum_mining_protocol.md target=_blank>Stratum mining protocol</a></div></div></div><div class=li><a class=i18n href=/en/developer/>More</a></div></div></div></div><div class="item Community allSelect"><span class=i18n>Community</span><div class=more_nav><div class=box><div class=li><a class=i18n href=/en/news/>News</a></div><div class=li><a class=i18n href=https://westar.io target=_blank>Westar Labs</a></div><div class=li><a class=i18n href=https://www.movelang.io target=_blank>Move Chinese Community</a></div><div class=li><a class=i18n href=https://stcscan.io target=_blank>Starcoin Explorer</a></div><div class=li><a class=i18n href=https://poll.starcoin.org target=_blank>Starcoin Polls</a></div></div></div></div><div class="item About allSelect"><a class=i18n href=/en/about><span class=i18n>About</span></a></div><div class="item Language allSelect hidden-xs"><div class=language-box><span class=i18n><img src=/img/icon_en.png alt>en</span></div><div class=more_nav><div class=box><div class="li nav-language"><div language=zh class=item><img src=/img/icon_zh.png alt>
中文</div></div><div class="li nav-language"><div language=en class=item><img src=/img/icon_en.png alt>
English</div></div></div></div></div><script>$(document).ready(function(){$(".nav-language .item").click(function(){let a=window.location.href,b=$(this).attr('language'),c="en";c!==b&&(a=a.replace(`/${c}/`,`/${b}/`),window.location.href=a)})})</script></div></div></div></div></div><div class=visible-xs style=display:block><div class="header_top m_header_top"></div><div class="top m_top scrollTop-nav"><div class="container m_container"><a href=/><div class=m_logo><img src=/img/logo.png></div></a><div class="m_nav m_nav_tap"><img src=/img/m_nav_more.png></div></div></div><div class=m_nav_model><div class="nav navClick m_nav_navigation"><div class="item Overview allSelect"><span class=i18n href=/en/>Overview</span><div class=more_nav><div class=box><div class=li><a class=i18n href=/downloads/Starcoin_en.pdf target=_blank>Starcoin
& Move</a></div><div class=li><a class=i18n href=/en/overview/technology_whitepaper/>Technology Whitepaper</a></div><div class=li><a class=i18n href=/en/overview/economy_whitepaper/>Economy Whitepaper</a></div></div></div></div><div class="item Guide allSelect"><span class=i18n>Learn</span><div class=more_nav><div class=box><div class=li><a class=i18n href=https://github.com/starcoinorg/starmask-extension/blob/main/docs/how-to-use.md target=_blank>StarMask Chrome Wallet</a></div><div class=li><a class=i18n href=/en/developer/cli/mint/>Node Mining</a></div><div class=li><a class=i18n href=/en/developer/cli/>Node Command</a></div></div></div></div><div class="item Developer allSelect"><span class=i18n>Developer</span><div class=more_nav><div class=box><div class=li><span class=i18n>Get Started</span><div class=second_nav><div class=li><a class=i18n href=/en/developer/setup/install target=_blank>Install</a></div><div class=li><a class=i18n href=/en/developer/setup/build target=_blank>Build from Source</a></div><div class=li><a class=i18n href=/en/developer/setup/run_by_docker target=_blank>Run by Docker</a></div><div class=li><a class=i18n href=/en/developer/setup/runnetwork target=_blank>Run/Join Network</a></div></div></div><div class=li><span class=i18n>Node</span><div class=second_nav><div class=li><a class=i18n href=/en/developer/key_concepts/concept>Key Concept</a></div><div class=li><a class=i18n href=/en/developer/rpc/rpc_document/>RPC Protocol & APIs</a></div><div class=li><a class=i18n href=/en/developer/sips/>SIPs</a></div><div class=li><a class=i18n href=/en/developer/sdk/>SDK</a></div></div></div><div class=li><span class=i18n>Move</span><div class=second_nav><div class=li><a class=i18n href=https://move-book.com/cn/index.html target=_blank>Move Book</a></div><div class=li><a class=i18n href=https://github.com/starcoinorg/starcoin/blob/master/vm/move-cli/README.md target=_blank>Move IDE</a></div><div class=li><a class=i18n href=https://github.com/starcoinorg/starcoin/blob/master/vm/move-cli/README.zh.md target=_blank>Move CLI</a></div><div class=li><a class=i18n href=/en/developer/move/example>Move Examples</a></div></div></div><div class=li><span class=i18n>Stratum Pool Guide</span><div class=second_nav><div class=li><a class=i18n href=https://github.com/starcoinorg/starcoin/discussions/2541 target=_blank>Stratum Pool Guide</a></div><div class=li><a class=i18n href=https://github.com/starcoinorg/starcoin/blob/b47429fc792fe9fabd1587fa60a9cae249f0b67f/stratum/stratum_mining_protocol.md target=_blank>Stratum mining protocol</a></div></div></div><div class=li><a class=i18n href=/en/developer/>More</a></div></div></div></div><div class="item Community allSelect"><span class=i18n>Community</span><div class=more_nav><div class=box><div class=li><a class=i18n href=/en/news/>News</a></div><div class=li><a class=i18n href=https://westar.io target=_blank>Westar Labs</a></div><div class=li><a class=i18n href=https://www.movelang.io target=_blank>Move Chinese Community</a></div><div class=li><a class=i18n href=https://stcscan.io target=_blank>Starcoin Explorer</a></div><div class=li><a class=i18n href=https://poll.starcoin.org target=_blank>Starcoin Polls</a></div></div></div></div><div class="item About allSelect"><a class=i18n href=/en/about><span class=i18n>About</span></a></div><div class="item Language allSelect hidden-xs"><div class=language-box><span class=i18n><img src=/img/icon_en.png alt>en</span></div><div class=more_nav><div class=box><div class="li nav-language"><div language=zh class=item><img src=/img/icon_zh.png alt>
中文</div></div><div class="li nav-language"><div language=en class=item><img src=/img/icon_en.png alt>
English</div></div></div></div></div><script>$(document).ready(function(){$(".nav-language .item").click(function(){let a=window.location.href,b=$(this).attr('language'),c="en";c!==b&&(a=a.replace(`/${c}/`,`/${b}/`),window.location.href=a)})})</script></div><div class=m-language><div language=zh class=item>中文<div class=line></div></div><div language=en class=item>English</div></div></div><div class=clearfix></div></div><script>$(document).ready(function(){const a=JSON.parse(localStorage.getItem('navActive'))||0;$(".navClick .item")[a].classList.add('navActive'),$(".p-language span, .m-language .item").click(function(){let a=window.location.href,b=$(this).attr('language'),c="en";c!==b&&(a=a.replace(`/${c}/`,`/${b}/`),window.location.href=a)}),$(".navClick .item").click(function(){let b=$(this)[0]||null;if(b){b.classList.add('navActive');let e=[],d=b.parentNode.children;for(var a=0,c=d.length;a<c;a++)d[a]!==b?e.push(d[a]):localStorage.setItem('navActive',a);e.forEach(a=>{a.classList.remove('navActive')})}$(this).attr("href")&&window.open($(this).attr("href"),"_self")}),$(".more_nav .box .li").click(function(){$(this).attr("href")&&window.open($(this).attr("href"),"_self")}),$(".m_nav_navigation").find(".allSelect").click(function(){$(this).attr("class").indexOf("m_tab_select")>-1?(console.log($(this)),$(this).removeClass("m_tab_select")):$(this).addClass("m_tab_select")}),$(".m_nav_tap").click(function(){$(this).find("img").attr("src")=="/img/m_nav_more.png"?($(this).find("img").attr("src","/img/m_nav_close.png"),$(".m_nav_model").show(),$(".m_nav_model").animate({height:"100%"}),$(".scrollTop-nav").addClass("home-nav")):($(this).find("img").attr("src","/img/m_nav_more.png"),$(".scrollTop-nav").removeClass("home-nav"),$(".m_nav_model").animate({height:"0%"}),$(".m_nav_model").hide())})})</script><div class=container><div class="developer m-column-drawer"><div class=developer_left><div class=developer_column><img class=dev_logo src=/img/dev_logo.png></div><div class=developer_column_list><ul><li><a href=/en/developer/setup/ target=_blank class=arrow>Getting started</a></li><li><a href=/en/developer/cli/ target=_blank class=arrow>CLI</a></li><li><a href=/en/developer/tutorials/ target=_blank class=arrow>Tutorials</a></li><li><a href=/en/developer/move/ target=_blank class=arrow>Move language</a></li><li><a href=/en/developer/key_concepts/ target=_blank class=arrow>Key Concepts</a></li><li><a href=/en/developer/rpc/ target=_blank class=arrow>RPC</a></li><li><a href=/en/developer/sdk/ target=_blank>SDK</a><ul></ul></li><li><a href=/en/developer/account/ target=_blank class=arrow>Starcoin Account Introduction</a></li><li><a href=/en/developer/sips/sip-21/ target=_blank>[SIP21] Receipt Identifier</a></li><li><a href=/en/developer/sips/sip-22/ target=_blank>[SIP22] NFT</a></li><li><a href=/en/developer/tech/ target=_blank class=arrow>Tech</a><ul><li><a href=/en/developer/tech/syncprotocol/ target=_blank class=active>Sync protocols</a></li><li><a href=/en/developer/tech/accumulator/ target=_blank>Introduction to Accumulator</a></li><li><a href=/en/developer/tech/vm/ target=_blank>VM</a></li><li><a href=/en/developer/tech/formal_verification/ target=_blank>Formal Verification</a></li></ul></li><li><a href=/en/developer/release-notes/ target=_blank class=arrow>Release Notes</a></li><li><a href=/en/developer/protocols/starcoin_nft/ target=_blank>NFT Protocol</a></li></ul></div></div><div class=developer_right><div class=m_mask></div><div class="visible-lg column_title"><span>Sync protocols</span></div><div class="visible-xs column_title m-d-title"><span>Sync protocols</span>
<img class=m_left_nav_click state=0 src=/img/arrow_down3.png></div><div class="content m-d-content"><article class=markdown><p>The Starcoin block chain contains a variety of sync modes, the two most common of which are described here <strong>full sync</strong>，<strong>fast sync</strong>.The following describes the sync process and sync protocols involved in each of these two modes.</p><h2 id=sync-block>Sync Block</h2><p>Sync block is used in both full and fast sync modes, and the main process is as follows:</p><ol><li>Find common ancestors with best peer using GetBlockHeaders protocol.</li><li>Use the GetBlockHeaders protocol to sync the BlockHeader for all missing local blocks.</li><li>Use the GetBlockInfos protocol to sync the BlockInfo for all missing local blocks.</li><li>Use the GetBlockBodies protocol to sync the BlockBody for all missing local blocks.</li><li>Rebuild the block using the corresponding BlockHeader, BlockInfo, BlockBody and add it to BlockChain based on the BlockNumber from small to large.</li></ol><h2 id=sync-state>Sync State</h2><p>Syne state is only used in fast sync mode and the main process is as follows:</p><ol><li>Determine the BlockHeader corresponding to the pivot using the GetBlockHeaders protocol with the best peer.</li><li>Get all StateNodes of the corresponding state tree recursively using the GetStateNodeByNodeHash protocol according to the state_root in BlockHeader.</li><li>Get all AccumulatorNodes of the corresponding transaction accumulator recursively using the GetAccumulatorNodeByNodeHash protocol, according to accumulator_root in BlockHeader.</li><li>Get all AccumulatorNodes of the corresponding transaction accumulator recursively using the GetAccumulatorNodeByNodeHash protocol, according to parent_block_accumulator_root in BlockHeader.</li></ol><h2 id=sync-protocols>Sync Protocols</h2><p>All protocols involved in full synchronization and fast synchronization are as follows:</p><h3 id=getblockheaders>GetBlockHeaders</h3><p><code>[block_id: Hash, max_size: usize, step: usize, reverse: bool]</code></p><p>Require peer to return a [BlockHeaders] message. Reply must contain a number of block headers, of rising number when <code>reverse</code> is <code>false</code>, falling when <code>true</code>, step blocks apart, beginning at block <code>block_id</code> in the canonical chain, and with at most <code>max_size</code> items.</p><h3 id=blockheaders>BlockHeaders</h3><p><code>[blockHeader_0, blockHeader_1, ...]</code></p><p>Reply to [GetBlockHeaders]. The items in the list are BlockHeader in the format described in the main Starcoin specification, previously asked for in a GetBlockHeaders message.</p><h3 id=getblockinfos>GetBlockInfos</h3><p><code>[block_id_0, block_id_1, ...]</code></p><p>Require peer to return a [BlockInfos] message.</p><h3 id=blockinfos>BlockInfos</h3><p>Reply to [GetBlockInfos]. The items in the list are BlockInfo in the format described in the main Starcoin specification, previously asked for in a GetBlockInfos message.</p><h3 id=getblockbodies>GetBlockBodies</h3><p><code>[block_id_0, block_id_1, ...]</code></p><p>Require peer to return a [BlockBodies] message.</p><h3 id=blockbodies>BlockBodies</h3><p><code>[[transactions_0, block_id_0] , ...]</code></p><p>Reply to [GetBlockBodies]. The items in the list are BlockBody, previously asked for in a GetBlockBodies message.</p><h3 id=getstatenodebynodehash>GetStateNodeByNodeHash</h3><p><code>node_hash: Hash</code></p><p>Require peer to return a [StateNode] message.</p><h3 id=statenode>StateNode</h3><p>Reply to [GetStateNodeByNodeHash].</p><h3 id=getaccumulatornodebynodehash>GetAccumulatorNodeByNodeHash</h3><p><code>node_hash: Hash</code></p><p>Require peer to return a [AccumulatorNode] message.</p><h3 id=accumulatornode>AccumulatorNode</h3><p>Reply to [GetAccumulatorNodeByNodeHash].</p></article></div></div></div><div id=dev_fixed_back class=code_fixed_back><div class=code_model><div class=head><div id=popup_close class=popup_close><img src=/img/close.png></div></div><div class=m_dev_list><ul><li><a href=/en/developer/setup/ target=_blank class=arrow>Getting started</a></li><li><a href=/en/developer/cli/ target=_blank class=arrow>CLI</a></li><li><a href=/en/developer/tutorials/ target=_blank class=arrow>Tutorials</a></li><li><a href=/en/developer/move/ target=_blank class=arrow>Move language</a></li><li><a href=/en/developer/key_concepts/ target=_blank class=arrow>Key Concepts</a></li><li><a href=/en/developer/rpc/ target=_blank class=arrow>RPC</a></li><li><a href=/en/developer/sdk/ target=_blank>SDK</a><ul></ul></li><li><a href=/en/developer/account/ target=_blank class=arrow>Starcoin Account Introduction</a></li><li><a href=/en/developer/sips/sip-21/ target=_blank>[SIP21] Receipt Identifier</a></li><li><a href=/en/developer/sips/sip-22/ target=_blank>[SIP22] NFT</a></li><li><a href=/en/developer/tech/ target=_blank class=arrow>Tech</a><ul><li><a href=/en/developer/tech/syncprotocol/ target=_blank class=active>Sync protocols</a></li><li><a href=/en/developer/tech/accumulator/ target=_blank>Introduction to Accumulator</a></li><li><a href=/en/developer/tech/vm/ target=_blank>VM</a></li><li><a href=/en/developer/tech/formal_verification/ target=_blank>Formal Verification</a></li></ul></li><li><a href=/en/developer/release-notes/ target=_blank class=arrow>Release Notes</a></li><li><a href=/en/developer/protocols/starcoin_nft/ target=_blank>NFT Protocol</a></li></ul></div></div></div></div><div class="footer visible-lg"><div class=container><div class=hr><div class="col-md-6 item logo-container" style=width:60%><a href=/en><div class=logo><img src=/img/logo.png></div></a>© 2018-2021 Starcoin.org</div><div class="col-md-3 item" style=width:25%>Technology</div><div class="col-md-3 item" style=width:15%>Community</div></div><div class=td><div class="col-md-6 item" style=width:60%></div><div class="col-md-3 item" style=width:25%><a target=_blank href="https://chrome.google.com/webstore/detail/starmask/mfhbebgoclkghebffdldpobeajmbecfk?hl=zh-CN">StarMask Wallet</a></div><div class="col-md-3 item" style=width:15%><a target=_blank href=https://starcoin.org/en/news/>News</a></div></div><div class=td><div class="col-md-6 item" style=width:60%></div><div class="col-md-3 item" style=width:25%><a target=_blank href=https://stcscan.io>Blockchain Explorer</a></div><div class="col-md-3 item" style=width:15%><a target=_blank href=https://westar.io>Westar Labs</a></div></div><div class=td><div class="col-md-6 item" style=width:60%></div><div class="col-md-3 item" style=width:25%><a target=_blank href=https://starcoin.org/en/developer/>Developer Docs</a></div><div class="col-md-3 item" style=width:15%><a target=_blank href=https://www.movelang.io>Move Chinese Community</a></div></div><div class=td><div class="col-md-6 item contact-container" style=width:60%><span data-toggle=tooltip data-placement=bottom title="WeChat Public Account: Starcoin区块链"><img src=/img/footer/wechat@2x.png></span>
<span data-toggle=tooltip data-placement=bottom title="Twitter: StarcoinSTC"><a href=https://twitter.com/starcoinstc target=_blank><img src=/img/footer/twitter@2x.png></a></span>
<span data-toggle=tooltip data-placement=bottom title="Join WeChat Group: starcoinorg"><img src=/img/footer/wechat_group@2x.png></span>
<span data-toggle=tooltip data-placement=bottom title="Discord: Starcoin Spaceship"><a href=https://discord.gg/96tKt5exaE target=_blank><img src=/img/footer/discord@2x.png></span></div><div class="col-md-3 item" style=width:25%><a target=_blank href=https://starcoin.org/en/developer/sdk/>SDK</a></div><div class="col-md-3 item" style=width:15%><a target=_blank href=https://github.com/starcoinorg/starcoin/discussions>GitHub Discussion</a></div></div></div></div><div class="m-footer visible-xs visible-sm visible-md"><div class=container><div class=go-contact-us>Technology</div><div class=row-li><div class=item><a target=_blank href="https://chrome.google.com/webstore/detail/starmask/mfhbebgoclkghebffdldpobeajmbecfk?hl=zh-CN">StarMask Wallet</a></div><div class=item><a target=_blank href=https://stcscan.io>Blockchain Explorer</a></div><div class=item><a target=_blank href=https://starcoin.org/en/developer/>Developer Docs</a></div><div class=item><a target=_blank href=https://starcoin.org/en/developer/sdk/>SDK</a></div></div><div class=go-contact-us>Community</div><div class=row-li><div class=item><a target=_blank href=https://starcoin.org/en/news/>News</a></div><div class=item><a target=_blank href=https://westar.io>Westar Labs</a></div><div class=item><a target=_blank href=https://www.movelang.io>Move Chinese Community</a></div><div class=item><a target=_blank href=https://github.com/starcoinorg/starcoin/discussions>GitHub Discussion</a></div></div><div class=go-contact-us>Contact Us</div><div class=row-li><div class=item>WeChat Public Account: Starcoin区块链</div><div class=item>Join WeChat Group: starcoinorg</div></div><div class=row-li><div class=item><a target=_blank href=https://twitter.com/starcoinstc>Twitter: StarcoinSTC</a></div><div class=item><a target=_blank href=https://discord.gg/96tKt5exaE>Discord: Starcoin Spaceship</a></div></div><div class=crt>© 2018-2021 Starcoin.org</div></div></div></body></html><script>$(document).ready(function(){$("#popup_close").click(function(){$("#dev_fixed_back").hide()}),$(".m-d-title").click(function(){$("#dev_fixed_back").show()})})</script>